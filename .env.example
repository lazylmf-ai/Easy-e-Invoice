# =================================================================
# EASY E-INVOICE PRODUCTION ENVIRONMENT CONFIGURATION
# =================================================================
# This file contains all environment variables needed for production deployment
# Copy this file to .env and update with your actual values
# SECURITY: Never commit actual production values to version control
# =================================================================

# Application Information
APP_NAME="Easy e-Invoice"
APP_VERSION="1.0.0"
APP_DESCRIPTION="Malaysian e-Invoice Compliance Helper"

# Environment Configuration
NODE_ENV="production"  # development | test | production
LOG_LEVEL="info"       # error | warn | info | debug
PORT=8787              # API server port
HOST="0.0.0.0"         # API server host

# =================================================================
# DATABASE CONFIGURATION
# =================================================================
# PostgreSQL database connection (Neon/managed PostgreSQL recommended for production)
DATABASE_URL="postgresql://username:password@ep-cool-cloud-123456.us-east-1.aws.neon.tech/einvoice_db?sslmode=require"
DATABASE_POOL_SIZE=20
DATABASE_TIMEOUT=30000
DATABASE_SSL_MODE="require"

# Database connection retry configuration
DB_RETRY_ATTEMPTS=3
DB_RETRY_DELAY=5000

# =================================================================
# AUTHENTICATION & SECURITY
# =================================================================
# JWT Configuration (use strong random keys in production)
JWT_SECRET="your-super-secret-jwt-key-must-be-256-bits-long-and-random"
JWT_EXPIRES_IN="24h"
JWT_REFRESH_EXPIRES_IN="7d"
JWT_ISSUER="easy-einvoice"
JWT_AUDIENCE="easy-einvoice-users"

# Session Configuration
SESSION_TIMEOUT_MS=86400000     # 24 hours
SESSION_CLEANUP_INTERVAL=3600000 # 1 hour

# Encryption for sensitive data
ENCRYPTION_KEY="your-32-character-encryption-key-here-must-be-exactly-32-chars"
ENCRYPTION_ALGORITHM="aes-256-gcm"

# Password Security
BCRYPT_ROUNDS=12
PASSWORD_MIN_LENGTH=8

# =================================================================
# CORS & SECURITY HEADERS
# =================================================================
CORS_ORIGINS="https://yourdomain.com,https://api.yourdomain.com"
CORS_CREDENTIALS=true
CORS_MAX_AGE=86400

# Security Headers
SECURITY_HSTS_MAX_AGE=31536000
SECURITY_CSP_REPORT_URI="/api/csp-report"
SECURITY_FRAME_OPTIONS="DENY"

# =================================================================
# RATE LIMITING & THROTTLING
# =================================================================
# Global rate limiting
RATE_LIMIT_WINDOW_MS=60000      # 1 minute
RATE_LIMIT_MAX_REQUESTS=100     # per window
RATE_LIMIT_SKIP_SUCCESSFUL=false

# Authentication specific rate limiting
AUTH_RATE_LIMIT_WINDOW_MS=900000  # 15 minutes
AUTH_RATE_LIMIT_MAX_ATTEMPTS=5    # per window
AUTH_RATE_LIMIT_LOCKOUT_DURATION=3600000 # 1 hour

# File upload rate limiting
FILE_RATE_LIMIT_WINDOW_MS=300000  # 5 minutes
FILE_RATE_LIMIT_MAX_UPLOADS=10    # per window
FILE_MAX_SIZE_MB=50               # Maximum file size

# =================================================================
# EMAIL SERVICE (RESEND)
# =================================================================
RESEND_API_KEY="re_your_resend_api_key_here"
FROM_EMAIL="noreply@yourdomain.com"
FROM_NAME="Easy e-Invoice"
REPLY_TO_EMAIL="support@yourdomain.com"

# Email templates
EMAIL_TEMPLATE_MAGIC_LINK="magic-link"
EMAIL_TEMPLATE_WELCOME="welcome"
EMAIL_TEMPLATE_ALERT="alert"

# Email rate limiting
EMAIL_RATE_LIMIT_PER_HOUR=50
EMAIL_RATE_LIMIT_PER_DAY=200

# =================================================================
# MALAYSIAN E-INVOICE API (MYINVOIS)
# =================================================================
# LHDN MyInvois Portal Integration
MYINVOIS_API_URL="https://api.myinvois.hasil.gov.my"
MYINVOIS_SANDBOX_URL="https://preprod-api.myinvois.hasil.gov.my"
MYINVOIS_CLIENT_ID="your-myinvois-client-id"
MYINVOIS_CLIENT_SECRET="your-myinvois-client-secret"
MYINVOIS_SCOPE="InvoicingAPI"
MYINVOIS_GRANT_TYPE="client_credentials"

# MyInvois Configuration
MYINVOIS_TIMEOUT=30000
MYINVOIS_RETRY_ATTEMPTS=3
MYINVOIS_RETRY_DELAY=2000
MYINVOIS_RATE_LIMIT=100  # requests per minute

# Malaysian Compliance Settings
MALAYSIA_TIMEZONE="Asia/Kuala_Lumpur"
MALAYSIA_CURRENCY="MYR"
MALAYSIA_SST_RATE=6
MALAYSIA_DECIMAL_PLACES=2

# =================================================================
# FILE STORAGE (CLOUDFLARE R2)
# =================================================================
# Cloudflare R2 Storage Configuration
R2_BUCKET_NAME="einvoice-production"
R2_ACCESS_KEY_ID="your-r2-access-key-id"
R2_SECRET_ACCESS_KEY="your-r2-secret-access-key"
R2_ENDPOINT="https://your-account-id.r2.cloudflarestorage.com"
R2_REGION="auto"
R2_PUBLIC_URL="https://files.yourdomain.com"

# File Storage Settings
STORAGE_MAX_FILE_SIZE=52428800    # 50MB
STORAGE_ALLOWED_TYPES="csv,pdf,json,xml"
STORAGE_RETENTION_DAYS=2555       # 7 years (Malaysian compliance)
STORAGE_VIRUS_SCAN=true

# CDN Configuration
CDN_URL="https://cdn.yourdomain.com"
CDN_CACHE_TTL=86400  # 24 hours

# =================================================================
# APPLICATION URLS
# =================================================================
# Frontend URLs
NEXT_PUBLIC_API_URL="https://api.yourdomain.com"
NEXT_PUBLIC_WEB_URL="https://yourdomain.com"
NEXT_PUBLIC_APP_NAME="Easy e-Invoice"
NEXT_PUBLIC_SUPPORT_EMAIL="support@yourdomain.com"

# API URLs
API_BASE_URL="https://api.yourdomain.com"
API_DOCS_URL="https://api.yourdomain.com/docs"
API_HEALTH_URL="https://api.yourdomain.com/health"

# Callback URLs
MAGIC_LINK_CALLBACK_URL="https://yourdomain.com/auth/callback"
OAUTH_CALLBACK_URL="https://yourdomain.com/auth/oauth/callback"

# =================================================================
# MONITORING & OBSERVABILITY
# =================================================================
# Sentry Error Tracking
SENTRY_DSN="https://your-sentry-dsn@sentry.io/project-id"
SENTRY_ENVIRONMENT="production"
SENTRY_SAMPLE_RATE=1.0
SENTRY_TRACES_SAMPLE_RATE=0.1
SENTRY_PROFILES_SAMPLE_RATE=0.1
SENTRY_ENABLE_PROFILING=true
SENTRY_ENABLE_PERFORMANCE=true

# Prometheus Metrics
METRICS_ENABLED=true
METRICS_PORT=9090
METRICS_PATH="/metrics"
METRICS_COLLECT_INTERVAL=60000

# Health Checks
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_PATH="/health"
HEALTH_CHECK_TIMEOUT=10000
HEALTH_CHECK_INTERVAL=30000

# Logging Configuration
LOG_FORMAT="json"
LOG_FILE_ENABLED=true
LOG_FILE_PATH="./logs"
LOG_FILE_MAX_SIZE="20m"
LOG_FILE_MAX_FILES="14d"
LOG_AUDIT_RETENTION="365d"

# =================================================================
# ALERTING & NOTIFICATIONS
# =================================================================
# Alert Channels
ALERT_EMAIL_ENABLED=true
ALERT_EMAIL_RECIPIENTS="admin@yourdomain.com,ops@yourdomain.com"

ALERT_SLACK_ENABLED=true
ALERT_SLACK_WEBHOOK_URL="https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK"
ALERT_SLACK_CHANNEL="#alerts"

ALERT_WEBHOOK_ENABLED=false
ALERT_WEBHOOK_URL="https://your-webhook-endpoint.com/alerts"

# Alert Thresholds
ALERT_ERROR_RATE_THRESHOLD=0.05      # 5%
ALERT_RESPONSE_TIME_THRESHOLD=5000   # 5 seconds
ALERT_MEMORY_USAGE_THRESHOLD=90      # 90%
ALERT_DISK_USAGE_THRESHOLD=85        # 85%

# =================================================================
# CACHING & PERFORMANCE
# =================================================================
# Redis Cache (optional)
REDIS_URL="redis://localhost:6379"
REDIS_PASSWORD=""
REDIS_DB=0
REDIS_MAX_RETRIES=3
REDIS_RETRY_DELAY=1000

# Application Caching
CACHE_ENABLED=true
CACHE_TTL_DEFAULT=3600      # 1 hour
CACHE_TTL_VALIDATION=7200   # 2 hours
CACHE_TTL_TIN_LOOKUP=86400  # 24 hours
CACHE_TTL_INDUSTRY_CODES=604800  # 7 days

# Performance Settings
WORKER_THREADS=4
CLUSTER_WORKERS=0  # 0 = auto (CPU count)
GRACEFUL_SHUTDOWN_TIMEOUT=30000
KEEP_ALIVE_TIMEOUT=5000

# =================================================================
# BACKUP & RECOVERY
# =================================================================
# Database Backups
BACKUP_ENABLED=true
BACKUP_SCHEDULE="0 2 * * *"  # Daily at 2 AM
BACKUP_RETENTION_DAYS=30
BACKUP_STORAGE_URL="s3://your-backup-bucket/einvoice"

# Data Export Settings
EXPORT_MAX_RECORDS=10000
EXPORT_TIMEOUT=300000  # 5 minutes
EXPORT_RETENTION_HOURS=24

# =================================================================
# FEATURE FLAGS
# =================================================================
# Features
FEATURE_MYINVOIS_INTEGRATION=true
FEATURE_BULK_IMPORT=true
FEATURE_PDF_GENERATION=true
FEATURE_EMAIL_NOTIFICATIONS=true
FEATURE_AUDIT_LOGGING=true
FEATURE_ADVANCED_VALIDATION=true

# Beta Features
FEATURE_BETA_ANALYTICS=false
FEATURE_BETA_MOBILE_APP=false
FEATURE_BETA_API_V2=false

# =================================================================
# DEVELOPMENT & TESTING (Remove in production)
# =================================================================
# Only for development/staging environments
DEBUG_MODE=false
DEBUG_SQL=false
DEBUG_VALIDATION=false
TEST_DATA_ENABLED=false

# =================================================================
# COMPLIANCE & LEGAL
# =================================================================
# Malaysian Compliance
PDPA_COMPLIANCE=true
LHDN_COMPLIANCE=true
AUDIT_LOG_ENABLED=true
DATA_RETENTION_POLICY=true

# Legal
TERMS_OF_SERVICE_URL="https://yourdomain.com/terms"
PRIVACY_POLICY_URL="https://yourdomain.com/privacy"
COOKIE_POLICY_URL="https://yourdomain.com/cookies"

# =================================================================
# MAINTENANCE
# =================================================================
# Maintenance Mode
MAINTENANCE_MODE=false
MAINTENANCE_MESSAGE="System maintenance in progress. Please try again later."
MAINTENANCE_ALLOWED_IPS=""  # Comma-separated IPs that can bypass maintenance

# Update Configuration
AUTO_UPDATE_ENABLED=false
UPDATE_CHECK_INTERVAL=86400000  # 24 hours
UPDATE_NOTIFICATION_EMAIL="admin@yourdomain.com"
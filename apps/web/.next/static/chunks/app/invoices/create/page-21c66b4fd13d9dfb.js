(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[101],{3127:function(e,t,i){Promise.resolve().then(i.bind(i,7105))},7105:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return Y}});var a=i(7573),s=i(7653),n=i(1695),l=i(286),o=i(5118),r=i(5043),d=i(8682),c=i(9902),m=i(7747),u=i(3333);let x=["MYR","USD","EUR","GBP","SGD","JPY","CNY","AUD","CAD","CHF"],p=c.z.string().regex(/^\d+(\.\d{1,2})?$/,"Must be a valid decimal with up to 2 decimal places"),v=c.z.string().regex(/^[1-9]\d*(\.\d{1,2})?$|^0\.\d*[1-9]\d*$/,"Must be a positive decimal"),h=c.z.string().regex(/^\d{5}$/,"Malaysian postcode must be 5 digits"),g=c.z.string().regex(/^(\+?6?0?1[0-46-9]-*\d{7,8})|(\+?6?0?[4-9]-*\d{7,8})$/,"Invalid Malaysian phone number format").optional(),b=c.z.string().email("Invalid email format"),f=c.z.object({line1:c.z.string().min(1,"Address line 1 is required").max(200),line2:c.z.string().max(200).optional(),city:c.z.string().min(1,"City is required").max(50),state:c.z.enum(["Johor","Kedah","Kelantan","Kuala Lumpur","Labuan","Melaka","Negeri Sembilan","Pahang","Penang","Perak","Perlis","Putrajaya","Sabah","Sarawak","Selangor","Terengganu"],{errorMap:()=>({message:"Must be a valid Malaysian state"})}),postcode:h,country:c.z.string().default("MY").refine(e=>"MY"===e,{message:"Only Malaysian addresses are supported"})}),j=c.z.object({name:c.z.string().min(1,"Name is required").max(200),tin:c.z.string().min(1,"TIN is required").max(20),brn:c.z.string().max(50).optional(),sstNumber:c.z.string().max(50).optional(),email:b.optional(),phone:g,address:f}),y=c.z.object({lineNumber:c.z.number().int().positive("Line number must be positive"),itemDescription:c.z.string().min(1,"Item description is required").max(500),itemSku:c.z.string().max(100).optional(),quantity:p.refine(e=>parseFloat(e)>0,{message:"Quantity must be greater than 0"}),unitPrice:p.refine(e=>parseFloat(e)>=0,{message:"Unit price cannot be negative"}),discountAmount:p.default("0.00"),lineTotal:p.refine(e=>parseFloat(e)>=0,{message:"Line total cannot be negative"}),sstRate:p.default("0.00").refine(e=>{let t=parseFloat(e);return t>=0&&t<=100},{message:"SST rate must be between 0 and 100"}),sstAmount:p.default("0.00"),taxExemptionCode:c.z.string().max(20).optional(),metadata:c.z.record(c.z.any()).optional()}).refine(e=>{let t=parseFloat(e.quantity),i=parseFloat(e.unitPrice),a=parseFloat(e.discountAmount);return .01>Math.abs(parseFloat(e.lineTotal)-(t*i-a))},{message:"Line total must equal (quantity \xd7 unit price) - discount amount",path:["lineTotal"]}).refine(e=>{let t=parseFloat(e.lineTotal),i=parseFloat(e.sstRate);return .01>Math.abs(parseFloat(e.sstAmount)-t*i/100)},{message:"SST amount must equal line total \xd7 SST rate \xf7 100",path:["sstAmount"]}),N=c.z.object({invoiceNumber:c.z.string().min(1,"Invoice number is required").max(100),eInvoiceType:c.z.enum(["01","02","03","04"],{errorMap:()=>({message:"Invalid e-Invoice type"})}).default("01"),issueDate:c.z.string().regex(/^\d{4}-\d{2}-\d{2}$/,"Issue date must be in YYYY-MM-DD format"),dueDate:c.z.string().regex(/^\d{4}-\d{2}-\d{2}$/,"Due date must be in YYYY-MM-DD format").optional(),currency:c.z.enum(x).default("MYR"),exchangeRate:p.default("1.000000").refine(e=>{let t=parseFloat(e);return t>0&&t<=9999.999999},{message:"Exchange rate must be positive and within valid range"}),subtotal:p.refine(e=>parseFloat(e)>=0,{message:"Subtotal cannot be negative"}),totalDiscount:p.default("0.00"),sstAmount:p.default("0.00"),grandTotal:v,isConsolidated:c.z.boolean().default(!1),consolidationPeriod:c.z.string().regex(/^\d{4}-\d{2}$/,"Consolidation period must be in YYYY-MM format").optional(),referenceInvoiceId:c.z.string().uuid().optional(),referenceInvoiceNumber:c.z.string().max(100).optional(),status:c.z.enum(["draft","validated","submitted","approved","rejected","cancelled"]).default("draft"),validationScore:c.z.number().int().min(0).max(100).default(0),notes:c.z.string().max(1e3).optional(),internalRef:c.z.string().max(100).optional(),poNumber:c.z.string().max(100).optional(),metadata:c.z.record(c.z.any()).optional()}).refine(e=>"MYR"===e.currency||1!==parseFloat(e.exchangeRate),{message:"Exchange rate must be provided for non-MYR currencies",path:["exchangeRate"]}).refine(e=>!["02","03"].includes(e.eInvoiceType)||e.referenceInvoiceId||e.referenceInvoiceNumber,{message:"Credit and debit notes must reference an original invoice",path:["referenceInvoiceId"]}).refine(e=>{if(e.dueDate){let t=new Date(e.issueDate);return new Date(e.dueDate)>=t}return!0},{message:"Due date must be on or after issue date",path:["dueDate"]});c.z.object({invoice:N,lineItems:c.z.array(y).min(1,"At least one line item is required"),supplier:j.optional(),buyer:j.optional()}).refine(e=>.01>Math.abs(e.lineItems.reduce((e,t)=>e+parseFloat(t.lineTotal),0)-parseFloat(e.invoice.subtotal)),{message:"Invoice subtotal must match sum of line item totals",path:["invoice","subtotal"]}).refine(e=>.01>Math.abs(e.lineItems.reduce((e,t)=>e+parseFloat(t.sstAmount),0)-parseFloat(e.invoice.sstAmount)),{message:"Invoice SST amount must match sum of line item SST amounts",path:["invoice","sstAmount"]}).refine(e=>{let t=parseFloat(e.invoice.subtotal),i=parseFloat(e.invoice.totalDiscount),a=parseFloat(e.invoice.sstAmount);return .01>Math.abs(parseFloat(e.invoice.grandTotal)-(t-i+a))},{message:"Grand total must equal subtotal - discount + SST",path:["invoice","grandTotal"]}).refine(e=>!!e.invoice.isConsolidated||!!e.buyer,{message:"Buyer information is required for non-consolidated invoices",path:["buyer"]});let z=c.z.object({invoiceNumber:c.z.string().min(1,"Invoice number is required").max(100),eInvoiceType:c.z.enum(["01","02","03","04"]).default("01"),issueDate:c.z.string().regex(/^\d{4}-\d{2}-\d{2}$/,"Issue date must be in YYYY-MM-DD format"),dueDate:c.z.string().regex(/^\d{4}-\d{2}-\d{2}$/,"Due date must be in YYYY-MM-DD format").optional(),currency:c.z.enum(x).default("MYR"),exchangeRate:c.z.string().regex(/^\d+\.\d{6}$/,"Exchange rate must have 6 decimal places").default("1.000000"),subtotal:c.z.string().regex(/^\d+\.\d{2}$/,"Subtotal must have 2 decimal places"),sstAmount:c.z.string().regex(/^\d+\.\d{2}$/,"SST amount must have 2 decimal places").default("0.00"),totalDiscount:c.z.string().regex(/^\d+\.\d{2}$/,"Total discount must have 2 decimal places").default("0.00"),grandTotal:c.z.string().regex(/^\d+\.\d{2}$/,"Grand total must have 2 decimal places"),isConsolidated:c.z.boolean().default(!1),referenceInvoiceId:c.z.string().optional(),status:c.z.enum(["draft","validated","submitted","approved","rejected","cancelled"]).default("draft"),buyerName:c.z.string().max(200).optional(),buyerTin:c.z.string().max(20).optional(),buyerEmail:c.z.string().email().optional(),buyerPhone:c.z.string().max(20).optional(),buyerAddress:c.z.string().max(500).optional(),poNumber:c.z.string().max(50).optional(),internalRef:c.z.string().max(100).optional(),notes:c.z.string().max(1e3).optional(),metadata:c.z.record(c.z.any()).optional()});z.partial();let I=c.z.object({itemDescription:c.z.string().min(1,"Item description is required").max(300),itemSku:c.z.string().max(50).optional(),quantity:c.z.string().regex(/^\d+(\.\d{1,3})?$/,"Quantity must be a valid number with up to 3 decimal places"),unitPrice:c.z.string().regex(/^\d+\.\d{2}$/,"Unit price must have 2 decimal places"),discountAmount:c.z.string().regex(/^\d+\.\d{2}$/,"Discount amount must have 2 decimal places").default("0.00"),lineTotal:c.z.string().regex(/^\d+\.\d{2}$/,"Line total must have 2 decimal places"),sstRate:c.z.string().regex(/^\d+\.\d{2}$/,"SST rate must have 2 decimal places").default("0.00"),sstAmount:c.z.string().regex(/^\d+\.\d{2}$/,"SST amount must have 2 decimal places").default("0.00"),taxExemptionCode:c.z.string().max(20).optional(),notes:c.z.string().max(500).optional(),metadata:c.z.record(c.z.any()).optional()});I.partial();let D=c.z.string().refine(e=>/^[A-Z]\d{10}$|^\d{12}$/.test(e),"Malaysian TIN must be format C1234567890 or 123456789012"),S=c.z.number().refine(e=>[0,6].includes(e),"SST rate must be 0% or 6%"),M=c.z.enum(["MYR","USD","SGD","EUR","GBP"]),R=c.z.enum(["01","02","03","04"]);c.z.object({name:c.z.string().min(1).max(255),brn:c.z.string().max(20).optional(),tin:D,sstNumber:c.z.string().max(20).optional(),industryCode:c.z.string().max(10).optional(),isSstRegistered:c.z.boolean().default(!1),currency:M.default("MYR")}),c.z.object({name:c.z.string().min(1).max(255),tin:c.z.string().max(20).optional(),countryCode:c.z.string().length(2).default("MY"),isIndividual:c.z.boolean().default(!1),address:c.z.object({line1:c.z.string().optional(),line2:c.z.string().optional(),city:c.z.string().optional(),state:c.z.string().optional(),postcode:c.z.string().optional(),country:c.z.string().default("MY")}).optional(),contact:c.z.object({email:c.z.string().email().optional(),phone:c.z.string().optional()}).optional()});let C=c.z.object({lineNumber:c.z.number().int().positive(),itemDescription:c.z.string().min(1).max(500),itemSku:c.z.string().max(100).optional(),quantity:c.z.number().positive(),unitPrice:c.z.number().min(0),discountAmount:c.z.number().min(0).default(0),sstRate:S.default(0),taxExemptionCode:c.z.string().max(20).optional()}).refine(e=>{let t=e.quantity*e.unitPrice-e.discountAmount;return e.sstRate,t>=0},"Line total must be positive");c.z.object({invoiceNumber:c.z.string().min(1).max(100),eInvoiceType:R.default("01"),issueDate:c.z.string().date(),dueDate:c.z.string().date().optional(),currency:M.default("MYR"),exchangeRate:c.z.number().positive().default(1),isConsolidated:c.z.boolean().default(!1),consolidationPeriod:c.z.string().regex(/^\d{4}-\d{2}$/).optional(),referenceInvoiceId:c.z.string().uuid().optional(),lineItems:c.z.array(C).min(1)}).refine(e=>("02"!==e.eInvoiceType||!!e.referenceInvoiceId)&&("MYR"===e.currency||1!==e.exchangeRate),"Invoice validation failed");let w=c.z.object({invoice:z,lineItems:c.z.array(I).min(1,"At least one line item is required"),buyerId:c.z.string().optional()}),T=x.map(e=>({code:e,name:({MYR:"Malaysian Ringgit",USD:"US Dollar",EUR:"Euro",GBP:"British Pound",SGD:"Singapore Dollar",JPY:"Japanese Yen",CNY:"Chinese Yuan",AUD:"Australian Dollar",CAD:"Canadian Dollar",CHF:"Swiss Franc"})[e]||e,symbol:({MYR:"RM",USD:"$",EUR:"€",GBP:"\xa3",SGD:"S$",JPY:"\xa5",CNY:"\xa5",AUD:"A$",CAD:"C$",CHF:"CHF"})[e]||e})),k=Object.entries({"01":"Invoice","02":"Credit Note","03":"Debit Note","04":"Refund Note"}).map(e=>{let[t,i]=e;return{value:t,label:i}});function F(e){var t,i,n,l,o,c,x,p;let{initialData:v,templateData:h,onSubmit:g,onValidate:b,isLoading:f=!1,mode:j="create"}=e,[y,N]=(0,s.useState)({subtotal:0,totalDiscount:0,totalSst:0,grandTotal:0}),{register:z,control:I,handleSubmit:D,watch:S,setValue:M,formState:{errors:R,isValid:C}}=(0,r.cI)({resolver:(0,d.F)(w),defaultValues:h||v||{invoice:{invoiceNumber:"",currency:"MYR",exchangeRate:"1.000000",eInvoiceType:"01",isConsolidated:!1,issueDate:new Date().toISOString().split("T")[0],subtotal:"0.00",sstAmount:"0.00",totalDiscount:"0.00",grandTotal:"0.00",status:"draft"},lineItems:[{itemDescription:"",quantity:"1",unitPrice:"0.00",discountAmount:"0.00",lineTotal:"0.00",sstRate:"0.00",sstAmount:"0.00"}]},mode:"onChange"}),{fields:F,append:Y,remove:A}=(0,r.Dq)({control:I,name:"lineItems"}),P=S(),q=(0,s.useCallback)(()=>{if(!P.lineItems)return;let e=0,t=0,i=0;P.lineItems.forEach((a,s)=>{let n=parseFloat(a.quantity||"0"),l=parseFloat(a.unitPrice||"0"),o=parseFloat(a.discountAmount||"0"),r=parseFloat(a.sstRate||"0"),d=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Math.round((e*t-i)*100)/100}(n,l,o),c=Math.round(d*r/100*100)/100;M("lineItems.".concat(s,".lineTotal"),d.toFixed(2)),M("lineItems.".concat(s,".sstAmount"),c.toFixed(2)),e+=d,t+=c,i+=o});let a=Math.round((e-0+t)*100)/100;M("invoice.subtotal",e.toFixed(2)),M("invoice.sstAmount",t.toFixed(2)),M("invoice.totalDiscount",i.toFixed(2)),M("invoice.grandTotal",a.toFixed(2)),N({subtotal:e,totalDiscount:i,totalSst:t,grandTotal:a})},[P.lineItems,M]);(0,s.useEffect)(()=>{q()},[q]);let $=e=>{F.length>1&&A(e)};return(0,a.jsxs)("form",{onSubmit:D(e=>{g(e)}),className:"space-y-8",children:[!(null===(t=P.invoice)||void 0===t?void 0:t.isConsolidated)&&(0,a.jsxs)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-6",children:"Buyer Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Buyer Name *"}),(0,a.jsx)("input",{type:"text",...z("invoice.buyerName"),className:"input mt-1",placeholder:"Customer/Buyer name"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Buyer TIN"}),(0,a.jsx)("input",{type:"text",...z("invoice.buyerTin"),className:"input mt-1",placeholder:"C1234567890 or 123456789012"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Required for B2B transactions"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),(0,a.jsx)("input",{type:"email",...z("invoice.buyerEmail"),className:"input mt-1",placeholder:"buyer@company.com"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Phone"}),(0,a.jsx)("input",{type:"tel",...z("invoice.buyerPhone"),className:"input mt-1",placeholder:"+60123456789"})]}),(0,a.jsxs)("div",{className:"sm:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Address"}),(0,a.jsx)("textarea",{...z("invoice.buyerAddress"),rows:2,className:"input mt-1",placeholder:"Complete buyer address"})]})]})]}),(0,a.jsxs)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-6",children:"Invoice Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Invoice Number *"}),(0,a.jsx)("input",{type:"text",...z("invoice.invoiceNumber"),className:"input mt-1 ".concat((null===(i=R.invoice)||void 0===i?void 0:i.invoiceNumber)?"border-red-300":""),placeholder:"INV-2024-001"}),(null===(n=R.invoice)||void 0===n?void 0:n.invoiceNumber)&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:R.invoice.invoiceNumber.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Invoice Type *"}),(0,a.jsx)("select",{...z("invoice.eInvoiceType"),className:"input mt-1",children:k.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Issue Date *"}),(0,a.jsx)("input",{type:"date",...z("invoice.issueDate"),className:"input mt-1 ".concat((null===(l=R.invoice)||void 0===l?void 0:l.issueDate)?"border-red-300":"")}),(null===(o=R.invoice)||void 0===o?void 0:o.issueDate)&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:R.invoice.issueDate.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Due Date"}),(0,a.jsx)("input",{type:"date",...z("invoice.dueDate"),className:"input mt-1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Currency *"}),(0,a.jsx)("select",{...z("invoice.currency"),className:"input mt-1",children:T.map(e=>(0,a.jsxs)("option",{value:e.code,children:[e.code," - ",e.name]},e.code))})]}),(null===(c=P.invoice)||void 0===c?void 0:c.currency)!=="MYR"&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Exchange Rate *"}),(0,a.jsx)("input",{type:"number",step:"0.000001",...z("invoice.exchangeRate"),className:"input mt-1",placeholder:"1.000000"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Rate from Bank Negara Malaysia"})]})]}),(0,a.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",...z("invoice.isConsolidated"),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),(0,a.jsx)("label",{className:"ml-2 block text-sm text-gray-900",children:"This is a consolidated B2C invoice"})]}),(null===(x=P.invoice)||void 0===x?void 0:x.isConsolidated)&&(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Consolidation Period"}),(0,a.jsx)("input",{type:"month",...z("invoice.metadata.consolidationPeriod"),className:"input mt-1"})]})}),["02","03"].includes((null===(p=P.invoice)||void 0===p?void 0:p.eInvoiceType)||"")&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Reference Invoice Number *"}),(0,a.jsx)("input",{type:"text",...z("invoice.referenceInvoiceId"),className:"input mt-1",placeholder:"Original invoice ID"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Required for credit and debit notes"})]})]}),(0,a.jsxs)("div",{className:"mt-6 grid grid-cols-1 gap-6 sm:grid-cols-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Internal Reference"}),(0,a.jsx)("input",{type:"text",...z("invoice.internalRef"),className:"input mt-1",placeholder:"Internal tracking number"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"PO Number"}),(0,a.jsx)("input",{type:"text",...z("invoice.poNumber"),className:"input mt-1",placeholder:"Purchase order number"})]})]})]}),(0,a.jsxs)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Line Items"}),(0,a.jsxs)("button",{type:"button",onClick:()=>{Y({itemDescription:"",quantity:"1",unitPrice:"0.00",discountAmount:"0.00",lineTotal:"0.00",sstRate:"0.00",sstAmount:"0.00"})},className:"btn-secondary flex items-center",children:[(0,a.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Add Item"]})]}),(0,a.jsx)("div",{className:"space-y-4",children:F.map((e,t)=>{var i,s,n,l,o,r,d,c,m,x,p,v,h,g;return(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h4",{className:"text-sm font-medium text-gray-700",children:["Item ",t+1]}),F.length>1&&(0,a.jsx)("button",{type:"button",onClick:()=>$(t),className:"text-red-600 hover:text-red-800",children:(0,a.jsx)(u.Z,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[(0,a.jsxs)("div",{className:"lg:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Description *"}),(0,a.jsx)("input",{type:"text",...z("lineItems.".concat(t,".itemDescription")),className:"input mt-1 ".concat((null===(s=R.lineItems)||void 0===s?void 0:null===(i=s[t])||void 0===i?void 0:i.itemDescription)?"border-red-300":""),placeholder:"Item description"}),(null===(l=R.lineItems)||void 0===l?void 0:null===(n=l[t])||void 0===n?void 0:n.itemDescription)&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:null===(r=R.lineItems[t])||void 0===r?void 0:null===(o=r.itemDescription)||void 0===o?void 0:o.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"SKU/Code"}),(0,a.jsx)("input",{type:"text",...z("lineItems.".concat(t,".itemSku")),className:"input mt-1",placeholder:"SKU or item code"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Quantity *"}),(0,a.jsx)("input",{type:"number",step:"0.001",...z("lineItems.".concat(t,".quantity")),className:"input mt-1 ".concat((null===(c=R.lineItems)||void 0===c?void 0:null===(d=c[t])||void 0===d?void 0:d.quantity)?"border-red-300":""),placeholder:"1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Unit Price *"}),(0,a.jsx)("input",{type:"number",step:"0.01",...z("lineItems.".concat(t,".unitPrice")),className:"input mt-1 ".concat((null===(x=R.lineItems)||void 0===x?void 0:null===(m=x[t])||void 0===m?void 0:m.unitPrice)?"border-red-300":""),placeholder:"0.00"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Discount"}),(0,a.jsx)("input",{type:"number",step:"0.01",...z("lineItems.".concat(t,".discountAmount")),className:"input mt-1",placeholder:"0.00"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"SST Rate (%)"}),(0,a.jsxs)("select",{...z("lineItems.".concat(t,".sstRate")),className:"input mt-1",children:[(0,a.jsx)("option",{value:"0.00",children:"0% (No SST)"}),(0,a.jsx)("option",{value:"6.00",children:"6% (Standard SST)"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Tax Exemption"}),(0,a.jsx)("input",{type:"text",...z("lineItems.".concat(t,".taxExemptionCode")),className:"input mt-1",placeholder:"Exemption code"})]})]}),(0,a.jsx)("div",{className:"mt-4 bg-gray-50 p-3 rounded-md",children:(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Line Total: "}),(0,a.jsx)("span",{className:"font-medium",children:(null===(v=P.lineItems)||void 0===v?void 0:null===(p=v[t])||void 0===p?void 0:p.lineTotal)||"0.00"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"SST Amount: "}),(0,a.jsx)("span",{className:"font-medium",children:(null===(g=P.lineItems)||void 0===g?void 0:null===(h=g[t])||void 0===h?void 0:h.sstAmount)||"0.00"})]})]})})]},e.id)})})]}),(0,a.jsxs)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-6",children:"Invoice Totals"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Subtotal:"}),(0,a.jsxs)("span",{className:"font-medium",children:["RM ",y.subtotal.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Total Discount:"}),(0,a.jsxs)("span",{className:"font-medium",children:["RM ",y.totalDiscount.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"SST (6%):"}),(0,a.jsxs)("span",{className:"font-medium",children:["RM ",y.totalSst.toFixed(2)]})]}),(0,a.jsx)("div",{className:"border-t pt-3",children:(0,a.jsxs)("div",{className:"flex justify-between text-lg font-semibold",children:[(0,a.jsx)("span",{children:"Grand Total:"}),(0,a.jsxs)("span",{children:["RM ",y.grandTotal.toFixed(2)]})]})})]})]}),(0,a.jsxs)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Additional Information"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Notes"}),(0,a.jsx)("textarea",{...z("invoice.notes"),rows:3,className:"input mt-1",placeholder:"Additional notes or comments..."})]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("div",{children:b&&(0,a.jsx)("button",{type:"button",onClick:()=>{b&&C&&b(P)},disabled:!C||f,className:"btn-secondary mr-4",children:"Validate Invoice"})}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>M("invoice.status","draft"),className:"btn-secondary",children:"Save as Draft"}),(0,a.jsx)("button",{type:"submit",disabled:!C||f,className:"btn-primary",children:f?"Saving...":"create"===j?"Create Invoice":"Update Invoice"})]})]})]})}function Y(){var e;let[t,i]=(0,s.useState)(!1),[r,d]=(0,s.useState)(""),[c,m]=(0,s.useState)(null),[u,x]=(0,s.useState)(null),{user:p}=(0,l.a)(),v=(0,n.useRouter)(),h=(0,n.useSearchParams)();(0,s.useEffect)(()=>{let e=h.get("template");e&&g(e)},[h]);let g=async e=>{try{let t=await o.hi.templates.use(e);t.template&&x(t.template.templateData)}catch(e){console.error("Failed to load template:",e),d("Failed to load template")}},b=async e=>{if(!(null==p?void 0:p.hasCompletedOnboarding)){d("Please complete organization setup first");return}i(!0),d("");try{let t=await o.hi.invoices.create(e);if(t.invoice)v.push("/invoices/".concat(t.invoice.id));else throw Error("Failed to create invoice")}catch(e){console.error("Invoice creation failed:",e),d(e.message||"Failed to create invoice. Please try again.")}finally{i(!1)}},f=async e=>{i(!0),d("");try{let t=await o.hi.invoices.validate(e);m(t.validation)}catch(e){console.error("Invoice validation failed:",e),d(e.message||"Failed to validate invoice")}finally{i(!1)}};return(null==p?void 0:p.hasCompletedOnboarding)?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Create Invoice"}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:"Create a new e-Invoice with Malaysian compliance validation"})]}),(0,a.jsx)("div",{className:"flex items-center space-x-4",children:(0,a.jsx)("button",{onClick:()=>v.push("/invoices"),className:"btn-secondary",children:"Cancel"})})]})}),r&&(0,a.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-md p-4",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),(0,a.jsx)("div",{className:"mt-2 text-sm text-red-700",children:(0,a.jsx)("p",{children:r})})]})]})}),c&&(0,a.jsx)("div",{className:"mb-6 bg-blue-50 border border-blue-200 rounded-md p-4",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsxs)("h3",{className:"text-sm font-medium text-blue-800",children:["Validation Results (Score: ",c.score,"/100)"]}),(0,a.jsx)("div",{className:"mt-2 text-sm text-blue-700",children:c.isValid?(0,a.jsx)("p",{children:"✅ Invoice passed Malaysian e-Invoice validation!"}):(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{children:"❌ Invoice has validation issues:"}),(0,a.jsx)("ul",{className:"mt-2 list-disc list-inside",children:null===(e=c.results)||void 0===e?void 0:e.map((e,t)=>(0,a.jsxs)("li",{className:"error"===e.severity?"text-red-700":"text-yellow-700",children:[e.message," - ",e.fixSuggestion]},t))})]})})]})]})}),(0,a.jsx)(F,{onSubmit:b,onValidate:f,isLoading:t,templateData:u,mode:"create"})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"Organization Setup Required"}),(0,a.jsx)("div",{className:"mt-2 text-sm text-yellow-700",children:(0,a.jsx)("p",{children:"You need to complete your organization setup before creating invoices."})}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("div",{className:"-mx-2 -my-1.5 flex",children:(0,a.jsx)("button",{onClick:()=>v.push("/org/setup"),className:"bg-yellow-50 px-2 py-1.5 rounded-md text-sm font-medium text-yellow-800 hover:bg-yellow-100",children:"Complete Setup"})})})]})]})})})})}},1236:function(e,t,i){"use strict";i.d(t,{KN:function(){return a.KN}});var a=i(3351)},2723:function(e,t,i){"use strict";i.d(t,{U2:function(){return a.U2},t8:function(){return a.t8}});var a=i(3351)},3957:function(e,t,i){"use strict";i.d(t,{M:function(){return a.M},_:function(){return a._}});var a=i(3587)}},function(e){e.O(0,[522,790,216,592,744],function(){return e(e.s=3127)}),_N_E=e.O()}]);
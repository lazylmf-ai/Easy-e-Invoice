(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[690],{1786:function(e,s,t){Promise.resolve().then(t.bind(t,3585))},3585:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return b}});var a=t(7573),l=t(7653),i=t(1695),c=t(286),r=t(5118),d=t(1593),n=t(3743),x=t(4802),m=t(2849),o=t(4329),h=t(6896),u=t(9785),p=t(9187);let g={draft:"bg-gray-100 text-gray-800",validated:"bg-blue-100 text-blue-800",submitted:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",cancelled:"bg-gray-100 text-gray-800"},j={"01":"Invoice","02":"Credit Note","03":"Debit Note","04":"Refund Note"},y={error:"text-red-600 bg-red-50 border-red-200",warning:"text-yellow-600 bg-yellow-50 border-yellow-200",info:"text-blue-600 bg-blue-50 border-blue-200"},N={error:p.Z,warning:o.Z,info:n.Z};function b(){var e,s;let[t,o]=(0,l.useState)(null),[b,v]=(0,l.useState)(!0),[f,w]=(0,l.useState)(""),[k,F]=(0,l.useState)(""),{user:D}=(0,c.a)(),S=(0,i.useRouter)(),C=(0,i.useParams)().id;(0,l.useEffect)(()=>{if(!(null==D?void 0:D.hasCompletedOnboarding)){S.push("/org/setup");return}I()},[C,null==D?void 0:D.hasCompletedOnboarding]);let I=async()=>{try{v(!0);let e=await r.hi.invoices.get(C);o(e.invoice)}catch(e){console.error("Failed to fetch invoice:",e),w(e.message||"Failed to fetch invoice"),404===e.status&&setTimeout(()=>S.push("/invoices"),2e3)}finally{v(!1)}},T=async()=>{try{F("validate"),await r.hi.invoices.validate(C),await I()}catch(e){console.error("Failed to validate invoice:",e),w(e.message||"Failed to validate invoice")}finally{F("")}},P=async()=>{try{F("duplicate");let e=await r.hi.invoices.duplicate(C);S.push("/invoices/".concat(e.invoice.id,"/edit"))}catch(e){console.error("Failed to duplicate invoice:",e),w(e.message||"Failed to duplicate invoice")}finally{F("")}},R=async()=>{try{F("pdf");let e=await r.hi.export.pdf(C),s=new Blob([await e.blob()],{type:"application/pdf"}),a=window.URL.createObjectURL(s),l=document.createElement("a");l.href=a,l.download="".concat((null==t?void 0:t.invoiceNumber)||C,".pdf"),document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(a),document.body.removeChild(l)}catch(e){console.error("Failed to export PDF:",e),w(e.message||"Failed to export PDF")}finally{F("")}};return b?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"animate-pulse",children:[(0,a.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-4"}),(0,a.jsx)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]})})]})})}):f&&!t?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(p.Z,{className:"h-5 w-5 text-red-400"})}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),(0,a.jsx)("div",{className:"mt-2 text-sm text-red-700",children:(0,a.jsx)("p",{children:f})}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("button",{onClick:()=>S.push("/invoices"),className:"bg-red-50 px-2 py-1.5 rounded-md text-sm font-medium text-red-800 hover:bg-red-100",children:"Back to Invoices"})})]})]})})})}):t?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("button",{onClick:()=>S.push("/invoices"),className:"mr-4 p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-full",children:(0,a.jsx)(d.Z,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:t.invoiceNumber}),(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(g[t.status]),children:t.status}),t.isConsolidated&&(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:"B2C Consolidated"})]}),(0,a.jsxs)("p",{className:"mt-2 text-gray-600",children:[j[t.eInvoiceType]," • Issued: ",new Date(t.issueDate).toLocaleDateString(),t.dueDate&&" • Due: ".concat(new Date(t.dueDate).toLocaleDateString())]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("button",{onClick:T,disabled:"validate"===k,className:"btn-secondary flex items-center",children:[(0,a.jsx)(n.Z,{className:"h-5 w-5 mr-2"}),"validate"===k?"Validating...":"Validate"]}),(0,a.jsxs)("button",{onClick:R,disabled:"pdf"===k,className:"btn-secondary flex items-center",children:[(0,a.jsx)(x.Z,{className:"h-5 w-5 mr-2"}),"pdf"===k?"Exporting...":"Export PDF"]}),(0,a.jsxs)("button",{onClick:P,disabled:"duplicate"===k,className:"btn-secondary flex items-center",children:[(0,a.jsx)(m.Z,{className:"h-5 w-5 mr-2"}),"duplicate"===k?"Duplicating...":"Duplicate"]}),["draft","validated"].includes(t.status)&&(0,a.jsxs)("button",{onClick:()=>S.push("/invoices/".concat(t.id,"/edit")),className:"btn-primary flex items-center",children:[(0,a.jsx)(h.Z,{className:"h-5 w-5 mr-2"}),"Edit"]})]})]})}),f&&(0,a.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-md p-4",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(p.Z,{className:"h-5 w-5 text-red-400"})}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),(0,a.jsx)("div",{className:"mt-2 text-sm text-red-700",children:(0,a.jsx)("p",{children:f})})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-8",children:[(0,a.jsxs)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Invoice Details"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Invoice Number"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:t.invoiceNumber})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Type"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:j[t.eInvoiceType]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Issue Date"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:new Date(t.issueDate).toLocaleDateString()})]}),t.dueDate&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Due Date"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:new Date(t.dueDate).toLocaleDateString()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Currency"}),(0,a.jsxs)("p",{className:"mt-1 text-sm text-gray-900",children:[t.currency,"MYR"!==t.currency&&" (Rate: ".concat(t.exchangeRate,")")]})]}),t.poNumber&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"PO Number"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:t.poNumber})]}),t.internalRef&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Internal Reference"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:t.internalRef})]})]}),t.notes&&(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Notes"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-900 whitespace-pre-wrap",children:t.notes})]})]}),(t.buyerName||!t.isConsolidated)&&(0,a.jsxs)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Buyer Information"}),t.buyerName?(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Name"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:t.buyerName})]}),t.buyerTin&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"TIN"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:t.buyerTin})]}),t.buyerEmail&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:t.buyerEmail})]}),t.buyerPhone&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Phone"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:t.buyerPhone})]}),t.buyerAddress&&(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Address"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-900 whitespace-pre-wrap",children:t.buyerAddress})]})]}):(0,a.jsx)("p",{className:"text-sm text-gray-500 italic",children:"No buyer information (B2C consolidated invoice)"})]}),(0,a.jsxs)("div",{className:"bg-white shadow-sm rounded-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Line Items"})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Item"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unit Price"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Discount"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SST"}),(0,a.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.lineItems.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.itemDescription}),e.itemSku&&(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["SKU: ",e.itemSku]})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:parseFloat(e.quantity).toFixed(3)}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[t.currency," ",parseFloat(e.unitPrice).toFixed(2)]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:parseFloat(e.discountAmount)>0?"".concat(t.currency," ").concat(parseFloat(e.discountAmount).toFixed(2)):"-"}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[parseFloat(e.sstRate),"%",parseFloat(e.sstAmount)>0&&" (".concat(t.currency," ").concat(parseFloat(e.sstAmount).toFixed(2),")")]}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium text-gray-900",children:[t.currency," ",parseFloat(e.lineTotal).toFixed(2)]})]},e.id))})]})})]}),(0,a.jsxs)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Totals"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Subtotal:"}),(0,a.jsxs)("span",{className:"font-medium",children:[t.currency," ",parseFloat(t.subtotal).toFixed(2)]})]}),parseFloat(t.totalDiscount)>0&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Total Discount:"}),(0,a.jsxs)("span",{className:"font-medium",children:["-",t.currency," ",parseFloat(t.totalDiscount).toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"SST (6%):"}),(0,a.jsxs)("span",{className:"font-medium",children:[t.currency," ",parseFloat(t.sstAmount).toFixed(2)]})]}),(0,a.jsx)("div",{className:"border-t pt-3",children:(0,a.jsxs)("div",{className:"flex justify-between text-lg font-semibold",children:[(0,a.jsx)("span",{children:"Grand Total:"}),(0,a.jsxs)("span",{children:[t.currency," ",parseFloat(t.grandTotal).toFixed(2)]})]})})]})]})]}),(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Compliance Status"}),(0,a.jsxs)("div",{className:"text-center mb-4",children:[(0,a.jsxs)("div",{className:"text-3xl font-bold ".concat((e=t.validationScore)>=90?"text-green-600":e>=70?"text-yellow-600":"text-red-600"),children:[t.validationScore,"/100"]}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:100===(s=t.validationScore)?"Fully Compliant":s>=90?"Minor Issues":s>=70?"Significant Issues":"Major Issues"}),t.lastValidatedAt&&(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Last validated: ",new Date(t.lastValidatedAt).toLocaleString()]})]}),t.validationResults.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:"Issues Found:"}),t.validationResults.map(e=>{let s=N[e.severity];return(0,a.jsx)("div",{className:"p-3 rounded-md border ".concat(y[e.severity]),children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)(s,{className:"h-4 w-4 mr-2 mt-0.5 flex-shrink-0"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:e.message}),e.fieldPath&&(0,a.jsxs)("p",{className:"text-xs opacity-75",children:["Field: ",e.fieldPath]}),e.fixSuggestion&&(0,a.jsxs)("p",{className:"text-xs mt-1 opacity-75",children:["Suggestion: ",e.fixSuggestion]})]})]})},e.id)})]})]}),(0,a.jsxs)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Supplier"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Company Name"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:t.organization.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"TIN"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:t.organization.tin})]}),t.organization.sstNumber&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"SST Number"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:t.organization.sstNumber})]})]})]}),(0,a.jsxs)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Quick Actions"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("button",{onClick:()=>window.print(),className:"w-full btn-secondary flex items-center justify-center",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"Print Preview"]}),(0,a.jsx)("button",{onClick:()=>{var e,s;return null===(e=(s=navigator).share)||void 0===e?void 0:e.call(s,{title:"Invoice ".concat(t.invoiceNumber),text:"Invoice ".concat(t.invoiceNumber," - ").concat(t.currency," ").concat(parseFloat(t.grandTotal).toFixed(2)),url:window.location.href})},className:"w-full btn-secondary",children:"Share Invoice"})]})]})]})]})]})}):null}}},function(e){e.O(0,[522,216,592,744],function(){return e(e.s=1786)}),_N_E=e.O()}]);
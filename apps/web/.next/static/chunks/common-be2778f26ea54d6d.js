"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[592],{286:function(t,e,o){o.d(e,{H:function(){return u},a:function(){return s}});var r=o(7573),a=o(7653),n=o(1695),i=o(5118);let c=(0,a.createContext)(void 0);function s(){let t=(0,a.useContext)(c);if(void 0===t)throw Error("useAuth must be used within an AuthProvider");return t}function u(t){let{children:e}=t,[o,s]=(0,a.useState)(null),[u,l]=(0,a.useState)(!0),h=(0,n.useRouter)();(0,a.useEffect)(()=>{(async()=>{if((0,i.bW)())try{await p()}catch(t){console.error("Failed to refresh user:",t),(0,i.Rn)()}l(!1)})()},[]);let d=async t=>{try{await i.hi.auth.sendMagicLink(t)}catch(t){throw console.error("Login failed:",t),t}},m=async t=>{try{let e=await i.hi.auth.verifyToken(t);if(e.token&&e.user)(0,i.uB)(e.token),s(e.user);else throw Error("Invalid response from verification")}catch(t){throw console.error("Token verification failed:",t),(0,i.Rn)(),t}},p=async()=>{try{let t=await i.hi.auth.me();if(t.user){let e=t.user;if(e.hasCompletedOnboarding&&e.orgId)try{let t=await i.hi.organization.get();t.organization&&(e={...e,organization:t.organization})}catch(t){console.warn("Failed to load organization details:",t)}s(e)}}catch(t){throw console.error("Failed to refresh user:",t),t}};return(0,r.jsx)(c.Provider,{value:{user:o,isLoading:u,isAuthenticated:!!o,login:d,verifyToken:m,logout:()=>{try{i.hi.auth.logout().catch(console.error)}finally{(0,i.Rn)(),s(null),h.push("/auth/login")}},refreshUser:p},children:e})}},5118:function(t,e,o){o.d(e,{Rn:function(){return i},bW:function(){return a},hi:function(){return s},uB:function(){return n}});let r=o(8263).ZP.create({baseURL:"http://localhost:8787",timeout:1e4,headers:{"Content-Type":"application/json"}});r.interceptors.request.use(t=>{let e=a();return e&&(t.headers.Authorization="Bearer ".concat(e)),t},t=>Promise.reject(t)),r.interceptors.response.use(t=>t,t=>{var e;return(null===(e=t.response)||void 0===e?void 0:e.status)===401&&(i(),window.location.href="/auth/login"),Promise.reject(t)});let a=()=>localStorage.getItem("auth_token"),n=t=>{localStorage.setItem("auth_token",t)},i=()=>{localStorage.removeItem("auth_token")},c=async t=>{try{return(await r.request(t)).data}catch(t){var e,o,a;throw{...null===(e=t.response)||void 0===e?void 0:e.data,status:null===(o=t.response)||void 0===o?void 0:o.status,statusText:null===(a=t.response)||void 0===a?void 0:a.statusText}}},s={auth:{sendMagicLink:t=>c({method:"POST",url:"/auth/magic-link",data:{email:t}}),verifyToken:t=>c({method:"POST",url:"/auth/verify",data:{token:t}}),me:()=>c({method:"GET",url:"/auth/me"}),logout:()=>c({method:"POST",url:"/auth/logout"})},organization:{get:()=>c({method:"GET",url:"/org"}),update:t=>c({method:"PUT",url:"/org",data:t}),setup:t=>c({method:"POST",url:"/org/setup",data:t}),validateTin:t=>c({method:"POST",url:"/org/validate-tin",data:{tin:t}})},invoices:{list:t=>c({method:"GET",url:"/invoices".concat(t?"?".concat(t):"")}),get:t=>c({method:"GET",url:"/invoices/".concat(t)}),create:t=>c({method:"POST",url:"/invoices",data:t}),update:(t,e)=>c({method:"PUT",url:"/invoices/".concat(t),data:e}),delete:t=>c({method:"DELETE",url:"/invoices/".concat(t)}),validate:t=>c({method:"POST",url:"/invoices/".concat(t,"/validate")}),duplicate:t=>c({method:"POST",url:"/invoices/".concat(t,"/duplicate")})},import:{parseCSV:t=>c({method:"POST",url:"/import/parse-csv",data:{csvData:t}}),importInvoices:t=>c({method:"POST",url:"/import/invoices",data:t}),startChunkedImport:t=>c({method:"POST",url:"/import/start-chunked-import",data:t}),getProgress:t=>c({method:"GET",url:"/import/progress/".concat(t)}),getTemplate:()=>c({method:"GET",url:"/import/template",headers:{Accept:"text/csv"}})},export:{generatePDF:t=>fetch("".concat("http://localhost:8787","/export/pdf"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))},body:JSON.stringify(t)}),generateJSON:t=>fetch("".concat("http://localhost:8787","/export/json"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))},body:JSON.stringify(t)}),generateCSV:t=>fetch("".concat("http://localhost:8787","/export/csv"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))},body:JSON.stringify(t)}),startBatchExport:t=>c({method:"POST",url:"/export/batch",data:t}),getJobStatus:t=>c({method:"GET",url:"/export/jobs/".concat(t)}),pdf:t=>fetch("".concat("http://localhost:8787","/export/pdf/").concat(t),{method:"GET",headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})},templates:{list:t=>c({method:"GET",url:"/templates",params:t}),get:t=>c({method:"GET",url:"/templates/".concat(t)}),create:t=>c({method:"POST",url:"/templates",data:t}),update:(t,e)=>c({method:"PUT",url:"/templates/".concat(t),data:e}),delete:t=>c({method:"DELETE",url:"/templates/".concat(t)}),use:t=>c({method:"POST",url:"/templates/".concat(t,"/use")}),getPresets:t=>c({method:"GET",url:"/templates/presets/industry",params:t?{category:t}:void 0}),getAnalytics:()=>c({method:"GET",url:"/templates/analytics/usage"})},dashboard:{getMetrics:()=>c({method:"GET",url:"/dashboard/metrics"})},health:()=>c({method:"GET",url:"/health"})}},5043:function(t,e,o){o.d(e,{Dq:function(){return r.Dq},cI:function(){return r.cI}});var r=o(3351)}}]);
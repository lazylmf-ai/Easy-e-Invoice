(()=>{var e={};e.id=101,e.ids=[101],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},7790:e=>{"use strict";e.exports=require("assert")},4770:e=>{"use strict";e.exports=require("crypto")},7702:e=>{"use strict";e.exports=require("events")},2048:e=>{"use strict";e.exports=require("fs")},2615:e=>{"use strict";e.exports=require("http")},5240:e=>{"use strict";e.exports=require("https")},9801:e=>{"use strict";e.exports=require("os")},5315:e=>{"use strict";e.exports=require("path")},6162:e=>{"use strict";e.exports=require("stream")},4175:e=>{"use strict";e.exports=require("tty")},7360:e=>{"use strict";e.exports=require("url")},1764:e=>{"use strict";e.exports=require("util")},1568:e=>{"use strict";e.exports=require("zlib")},9154:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>r.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>c,routeModule:()=>x,tree:()=>d}),s(3317),s(8928),s(7824);var i=s(3282),a=s(5736),n=s(3906),r=s.n(n),l=s(6880),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let d=["",{children:["invoices",{children:["create",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,3317)),"/Users/lazylmf/StudioProjects/Easy-e-Invoice/apps/web/src/app/invoices/create/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,8928)),"/Users/lazylmf/StudioProjects/Easy-e-Invoice/apps/web/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,7824,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/lazylmf/StudioProjects/Easy-e-Invoice/apps/web/src/app/invoices/create/page.tsx"],m="/invoices/create/page",u={require:s,loadChunk:()=>Promise.resolve()},x=new i.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/invoices/create/page",pathname:"/invoices/create",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},5910:(e,t,s)=>{Promise.resolve().then(s.bind(s,1108))},1108:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>$});var i=s(3227),a=s(3677),n=s(1043),r=s(3172),l=s(7674),o=s(3395),d=s(5210),c=s(6419),m=s(5562),u=s(8305);let x=["MYR","USD","EUR","GBP","SGD","JPY","CNY","AUD","CAD","CHF"],p=c.z.string().regex(/^\d+(\.\d{1,2})?$/,"Must be a valid decimal with up to 2 decimal places"),h=c.z.string().regex(/^[1-9]\d*(\.\d{1,2})?$|^0\.\d*[1-9]\d*$/,"Must be a positive decimal"),g=c.z.string().regex(/^\d{5}$/,"Malaysian postcode must be 5 digits"),v=c.z.string().regex(/^(\+?6?0?1[0-46-9]-*\d{7,8})|(\+?6?0?[4-9]-*\d{7,8})$/,"Invalid Malaysian phone number format").optional(),b=c.z.string().email("Invalid email format"),j=c.z.object({line1:c.z.string().min(1,"Address line 1 is required").max(200),line2:c.z.string().max(200).optional(),city:c.z.string().min(1,"City is required").max(50),state:c.z.enum(["Johor","Kedah","Kelantan","Kuala Lumpur","Labuan","Melaka","Negeri Sembilan","Pahang","Penang","Perak","Perlis","Putrajaya","Sabah","Sarawak","Selangor","Terengganu"],{errorMap:()=>({message:"Must be a valid Malaysian state"})}),postcode:g,country:c.z.string().default("MY").refine(e=>"MY"===e,{message:"Only Malaysian addresses are supported"})}),y=c.z.object({name:c.z.string().min(1,"Name is required").max(200),tin:c.z.string().min(1,"TIN is required").max(20),brn:c.z.string().max(50).optional(),sstNumber:c.z.string().max(50).optional(),email:b.optional(),phone:v,address:j}),f=c.z.object({lineNumber:c.z.number().int().positive("Line number must be positive"),itemDescription:c.z.string().min(1,"Item description is required").max(500),itemSku:c.z.string().max(100).optional(),quantity:p.refine(e=>parseFloat(e)>0,{message:"Quantity must be greater than 0"}),unitPrice:p.refine(e=>parseFloat(e)>=0,{message:"Unit price cannot be negative"}),discountAmount:p.default("0.00"),lineTotal:p.refine(e=>parseFloat(e)>=0,{message:"Line total cannot be negative"}),sstRate:p.default("0.00").refine(e=>{let t=parseFloat(e);return t>=0&&t<=100},{message:"SST rate must be between 0 and 100"}),sstAmount:p.default("0.00"),taxExemptionCode:c.z.string().max(20).optional(),metadata:c.z.record(c.z.any()).optional()}).refine(e=>{let t=parseFloat(e.quantity),s=parseFloat(e.unitPrice),i=parseFloat(e.discountAmount);return .01>Math.abs(parseFloat(e.lineTotal)-(t*s-i))},{message:"Line total must equal (quantity \xd7 unit price) - discount amount",path:["lineTotal"]}).refine(e=>{let t=parseFloat(e.lineTotal),s=parseFloat(e.sstRate);return .01>Math.abs(parseFloat(e.sstAmount)-t*s/100)},{message:"SST amount must equal line total \xd7 SST rate \xf7 100",path:["sstAmount"]}),N=c.z.object({invoiceNumber:c.z.string().min(1,"Invoice number is required").max(100),eInvoiceType:c.z.enum(["01","02","03","04"],{errorMap:()=>({message:"Invalid e-Invoice type"})}).default("01"),issueDate:c.z.string().regex(/^\d{4}-\d{2}-\d{2}$/,"Issue date must be in YYYY-MM-DD format"),dueDate:c.z.string().regex(/^\d{4}-\d{2}-\d{2}$/,"Due date must be in YYYY-MM-DD format").optional(),currency:c.z.enum(x).default("MYR"),exchangeRate:p.default("1.000000").refine(e=>{let t=parseFloat(e);return t>0&&t<=9999.999999},{message:"Exchange rate must be positive and within valid range"}),subtotal:p.refine(e=>parseFloat(e)>=0,{message:"Subtotal cannot be negative"}),totalDiscount:p.default("0.00"),sstAmount:p.default("0.00"),grandTotal:h,isConsolidated:c.z.boolean().default(!1),consolidationPeriod:c.z.string().regex(/^\d{4}-\d{2}$/,"Consolidation period must be in YYYY-MM format").optional(),referenceInvoiceId:c.z.string().uuid().optional(),referenceInvoiceNumber:c.z.string().max(100).optional(),status:c.z.enum(["draft","validated","submitted","approved","rejected","cancelled"]).default("draft"),validationScore:c.z.number().int().min(0).max(100).default(0),notes:c.z.string().max(1e3).optional(),internalRef:c.z.string().max(100).optional(),poNumber:c.z.string().max(100).optional(),metadata:c.z.record(c.z.any()).optional()}).refine(e=>"MYR"===e.currency||1!==parseFloat(e.exchangeRate),{message:"Exchange rate must be provided for non-MYR currencies",path:["exchangeRate"]}).refine(e=>!["02","03"].includes(e.eInvoiceType)||e.referenceInvoiceId||e.referenceInvoiceNumber,{message:"Credit and debit notes must reference an original invoice",path:["referenceInvoiceId"]}).refine(e=>{if(e.dueDate){let t=new Date(e.issueDate);return new Date(e.dueDate)>=t}return!0},{message:"Due date must be on or after issue date",path:["dueDate"]});c.z.object({invoice:N,lineItems:c.z.array(f).min(1,"At least one line item is required"),supplier:y.optional(),buyer:y.optional()}).refine(e=>.01>Math.abs(e.lineItems.reduce((e,t)=>e+parseFloat(t.lineTotal),0)-parseFloat(e.invoice.subtotal)),{message:"Invoice subtotal must match sum of line item totals",path:["invoice","subtotal"]}).refine(e=>.01>Math.abs(e.lineItems.reduce((e,t)=>e+parseFloat(t.sstAmount),0)-parseFloat(e.invoice.sstAmount)),{message:"Invoice SST amount must match sum of line item SST amounts",path:["invoice","sstAmount"]}).refine(e=>{let t=parseFloat(e.invoice.subtotal),s=parseFloat(e.invoice.totalDiscount),i=parseFloat(e.invoice.sstAmount);return .01>Math.abs(parseFloat(e.invoice.grandTotal)-(t-s+i))},{message:"Grand total must equal subtotal - discount + SST",path:["invoice","grandTotal"]}).refine(e=>!!e.invoice.isConsolidated||!!e.buyer,{message:"Buyer information is required for non-consolidated invoices",path:["buyer"]});let z=c.z.object({invoiceNumber:c.z.string().min(1,"Invoice number is required").max(100),eInvoiceType:c.z.enum(["01","02","03","04"]).default("01"),issueDate:c.z.string().regex(/^\d{4}-\d{2}-\d{2}$/,"Issue date must be in YYYY-MM-DD format"),dueDate:c.z.string().regex(/^\d{4}-\d{2}-\d{2}$/,"Due date must be in YYYY-MM-DD format").optional(),currency:c.z.enum(x).default("MYR"),exchangeRate:c.z.string().regex(/^\d+\.\d{6}$/,"Exchange rate must have 6 decimal places").default("1.000000"),subtotal:c.z.string().regex(/^\d+\.\d{2}$/,"Subtotal must have 2 decimal places"),sstAmount:c.z.string().regex(/^\d+\.\d{2}$/,"SST amount must have 2 decimal places").default("0.00"),totalDiscount:c.z.string().regex(/^\d+\.\d{2}$/,"Total discount must have 2 decimal places").default("0.00"),grandTotal:c.z.string().regex(/^\d+\.\d{2}$/,"Grand total must have 2 decimal places"),isConsolidated:c.z.boolean().default(!1),referenceInvoiceId:c.z.string().optional(),status:c.z.enum(["draft","validated","submitted","approved","rejected","cancelled"]).default("draft"),buyerName:c.z.string().max(200).optional(),buyerTin:c.z.string().max(20).optional(),buyerEmail:c.z.string().email().optional(),buyerPhone:c.z.string().max(20).optional(),buyerAddress:c.z.string().max(500).optional(),poNumber:c.z.string().max(50).optional(),internalRef:c.z.string().max(100).optional(),notes:c.z.string().max(1e3).optional(),metadata:c.z.record(c.z.any()).optional()});z.partial();let I=c.z.object({itemDescription:c.z.string().min(1,"Item description is required").max(300),itemSku:c.z.string().max(50).optional(),quantity:c.z.string().regex(/^\d+(\.\d{1,3})?$/,"Quantity must be a valid number with up to 3 decimal places"),unitPrice:c.z.string().regex(/^\d+\.\d{2}$/,"Unit price must have 2 decimal places"),discountAmount:c.z.string().regex(/^\d+\.\d{2}$/,"Discount amount must have 2 decimal places").default("0.00"),lineTotal:c.z.string().regex(/^\d+\.\d{2}$/,"Line total must have 2 decimal places"),sstRate:c.z.string().regex(/^\d+\.\d{2}$/,"SST rate must have 2 decimal places").default("0.00"),sstAmount:c.z.string().regex(/^\d+\.\d{2}$/,"SST amount must have 2 decimal places").default("0.00"),taxExemptionCode:c.z.string().max(20).optional(),notes:c.z.string().max(500).optional(),metadata:c.z.record(c.z.any()).optional()});I.partial();let S={corporate:/^C\d{10}$/,individual:/^\d{12}$/,government:/^G\d{10}$/,nonprofit:/^N\d{10}$/},D={corporate:"C1234567890",individual:"123456789012",government:"G1234567890",nonprofit:"N1234567890"},M=c.z.string().refine(e=>/^[A-Z]\d{10}$|^\d{12}$/.test(e),"Malaysian TIN must be format C1234567890 or 123456789012"),R=c.z.number().refine(e=>[0,6].includes(e),"SST rate must be 0% or 6%"),w=c.z.enum(["MYR","USD","SGD","EUR","GBP"]),C=c.z.enum(["01","02","03","04"]);c.z.object({name:c.z.string().min(1).max(255),brn:c.z.string().max(20).optional(),tin:M,sstNumber:c.z.string().max(20).optional(),industryCode:c.z.string().max(10).optional(),isSstRegistered:c.z.boolean().default(!1),currency:w.default("MYR")}),c.z.object({name:c.z.string().min(1).max(255),tin:c.z.string().max(20).optional(),countryCode:c.z.string().length(2).default("MY"),isIndividual:c.z.boolean().default(!1),address:c.z.object({line1:c.z.string().optional(),line2:c.z.string().optional(),city:c.z.string().optional(),state:c.z.string().optional(),postcode:c.z.string().optional(),country:c.z.string().default("MY")}).optional(),contact:c.z.object({email:c.z.string().email().optional(),phone:c.z.string().optional()}).optional()});let T=c.z.object({lineNumber:c.z.number().int().positive(),itemDescription:c.z.string().min(1).max(500),itemSku:c.z.string().max(100).optional(),quantity:c.z.number().positive(),unitPrice:c.z.number().min(0),discountAmount:c.z.number().min(0).default(0),sstRate:R.default(0),taxExemptionCode:c.z.string().max(20).optional()}).refine(e=>{let t=e.quantity*e.unitPrice-e.discountAmount;return e.sstRate,t>=0},"Line total must be positive");c.z.object({invoiceNumber:c.z.string().min(1).max(100),eInvoiceType:C.default("01"),issueDate:c.z.string().date(),dueDate:c.z.string().date().optional(),currency:w.default("MYR"),exchangeRate:c.z.number().positive().default(1),isConsolidated:c.z.boolean().default(!1),consolidationPeriod:c.z.string().regex(/^\d{4}-\d{2}$/).optional(),referenceInvoiceId:c.z.string().uuid().optional(),lineItems:c.z.array(T).min(1)}).refine(e=>("02"!==e.eInvoiceType||!!e.referenceInvoiceId)&&("MYR"===e.currency||1!==e.exchangeRate),"Invoice validation failed");let P=c.z.object({invoice:z,lineItems:c.z.array(I).min(1,"At least one line item is required"),buyerId:c.z.string().optional()}),q=x.map(e=>({code:e,name:({MYR:"Malaysian Ringgit",USD:"US Dollar",EUR:"Euro",GBP:"British Pound",SGD:"Singapore Dollar",JPY:"Japanese Yen",CNY:"Chinese Yuan",AUD:"Australian Dollar",CAD:"Canadian Dollar",CHF:"Swiss Franc"})[e]||e,symbol:({MYR:"RM",USD:"$",EUR:"€",GBP:"\xa3",SGD:"S$",JPY:"\xa5",CNY:"\xa5",AUD:"A$",CAD:"C$",CHF:"CHF"})[e]||e})),A=Object.entries({"01":"Invoice","02":"Credit Note","03":"Debit Note","04":"Refund Note"}).map(([e,t])=>({value:e,label:t}));function k({initialData:e,templateData:t,onSubmit:s,onValidate:n,isLoading:r=!1,mode:l="create"}){let[c,x]=(0,a.useState)({subtotal:0,totalDiscount:0,totalSst:0,grandTotal:0}),{register:p,control:h,handleSubmit:g,watch:v,setValue:b,formState:{errors:j,isValid:y}}=(0,o.cI)({resolver:(0,d.F)(P),defaultValues:t||e||{invoice:{invoiceNumber:"",currency:"MYR",exchangeRate:"1.000000",eInvoiceType:"01",isConsolidated:!1,issueDate:new Date().toISOString().split("T")[0],subtotal:"0.00",sstAmount:"0.00",totalDiscount:"0.00",grandTotal:"0.00",status:"draft"},lineItems:[{itemDescription:"",quantity:"1",unitPrice:"0.00",discountAmount:"0.00",lineTotal:"0.00",sstRate:"0.00",sstAmount:"0.00"}]},mode:"onChange"}),{fields:f,append:N,remove:z}=(0,o.Dq)({control:h,name:"lineItems"}),I=v();(0,a.useCallback)(()=>{if(!I.lineItems)return;let e=0,t=0,s=0;I.lineItems.forEach((i,a)=>{let n=parseFloat(i.quantity||"0"),r=parseFloat(i.unitPrice||"0"),l=parseFloat(i.discountAmount||"0"),o=parseFloat(i.sstRate||"0"),d=function(e,t,s=0){return Math.round((e*t-s)*100)/100}(n,r,l),c=Math.round(d*o/100*100)/100;b(`lineItems.${a}.lineTotal`,d.toFixed(2)),b(`lineItems.${a}.sstAmount`,c.toFixed(2)),e+=d,t+=c,s+=l});let i=Math.round((e-0+t)*100)/100;b("invoice.subtotal",e.toFixed(2)),b("invoice.sstAmount",t.toFixed(2)),b("invoice.totalDiscount",s.toFixed(2)),b("invoice.grandTotal",i.toFixed(2)),x({subtotal:e,totalDiscount:s,totalSst:t,grandTotal:i})},[I.lineItems,b]);let S=e=>{f.length>1&&z(e)};return(0,i.jsxs)("form",{onSubmit:g(e=>{s(e)}),className:"space-y-8",children:[!I.invoice?.isConsolidated&&(0,i.jsxs)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[i.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-6",children:"Buyer Information"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[(0,i.jsxs)("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Buyer Name *"}),i.jsx("input",{type:"text",...p("invoice.buyerName"),className:"input mt-1",placeholder:"Customer/Buyer name"})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Buyer TIN"}),i.jsx("input",{type:"text",...p("invoice.buyerTin"),className:"input mt-1",placeholder:"C1234567890 or 123456789012"}),i.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Required for B2B transactions"})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),i.jsx("input",{type:"email",...p("invoice.buyerEmail"),className:"input mt-1",placeholder:"buyer@company.com"})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Phone"}),i.jsx("input",{type:"tel",...p("invoice.buyerPhone"),className:"input mt-1",placeholder:"+60123456789"})]}),(0,i.jsxs)("div",{className:"sm:col-span-2",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Address"}),i.jsx("textarea",{...p("invoice.buyerAddress"),rows:2,className:"input mt-1",placeholder:"Complete buyer address"})]})]})]}),(0,i.jsxs)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[i.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-6",children:"Invoice Information"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:[(0,i.jsxs)("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Invoice Number *"}),i.jsx("input",{type:"text",...p("invoice.invoiceNumber"),className:`input mt-1 ${j.invoice?.invoiceNumber?"border-red-300":""}`,placeholder:"INV-2024-001"}),j.invoice?.invoiceNumber&&i.jsx("p",{className:"mt-1 text-sm text-red-600",children:j.invoice.invoiceNumber.message})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Invoice Type *"}),i.jsx("select",{...p("invoice.eInvoiceType"),className:"input mt-1",children:A.map(e=>i.jsx("option",{value:e.value,children:e.label},e.value))})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Issue Date *"}),i.jsx("input",{type:"date",...p("invoice.issueDate"),className:`input mt-1 ${j.invoice?.issueDate?"border-red-300":""}`}),j.invoice?.issueDate&&i.jsx("p",{className:"mt-1 text-sm text-red-600",children:j.invoice.issueDate.message})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Due Date"}),i.jsx("input",{type:"date",...p("invoice.dueDate"),className:"input mt-1"})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Currency *"}),i.jsx("select",{...p("invoice.currency"),className:"input mt-1",children:q.map(e=>(0,i.jsxs)("option",{value:e.code,children:[e.code," - ",e.name]},e.code))})]}),I.invoice?.currency!=="MYR"&&(0,i.jsxs)("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Exchange Rate *"}),i.jsx("input",{type:"number",step:"0.000001",...p("invoice.exchangeRate"),className:"input mt-1",placeholder:"1.000000"}),i.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Rate from Bank Negara Malaysia"})]})]}),(0,i.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[i.jsx("input",{type:"checkbox",...p("invoice.isConsolidated"),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),i.jsx("label",{className:"ml-2 block text-sm text-gray-900",children:"This is a consolidated B2C invoice"})]}),I.invoice?.isConsolidated&&i.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:(0,i.jsxs)("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Consolidation Period"}),i.jsx("input",{type:"month",...p("invoice.metadata.consolidationPeriod"),className:"input mt-1"})]})}),["02","03"].includes(I.invoice?.eInvoiceType||"")&&(0,i.jsxs)("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Reference Invoice Number *"}),i.jsx("input",{type:"text",...p("invoice.referenceInvoiceId"),className:"input mt-1",placeholder:"Original invoice ID"}),i.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Required for credit and debit notes"})]})]}),(0,i.jsxs)("div",{className:"mt-6 grid grid-cols-1 gap-6 sm:grid-cols-3",children:[(0,i.jsxs)("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Internal Reference"}),i.jsx("input",{type:"text",...p("invoice.internalRef"),className:"input mt-1",placeholder:"Internal tracking number"})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"PO Number"}),i.jsx("input",{type:"text",...p("invoice.poNumber"),className:"input mt-1",placeholder:"Purchase order number"})]})]})]}),(0,i.jsxs)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[i.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Line Items"}),(0,i.jsxs)("button",{type:"button",onClick:()=>{N({itemDescription:"",quantity:"1",unitPrice:"0.00",discountAmount:"0.00",lineTotal:"0.00",sstRate:"0.00",sstAmount:"0.00"})},className:"btn-secondary flex items-center",children:[i.jsx(m.Z,{className:"h-4 w-4 mr-2"}),"Add Item"]})]}),i.jsx("div",{className:"space-y-4",children:f.map((e,t)=>(0,i.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,i.jsxs)("h4",{className:"text-sm font-medium text-gray-700",children:["Item ",t+1]}),f.length>1&&i.jsx("button",{type:"button",onClick:()=>S(t),className:"text-red-600 hover:text-red-800",children:i.jsx(u.Z,{className:"h-4 w-4"})})]}),(0,i.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[(0,i.jsxs)("div",{className:"lg:col-span-2",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description *"}),i.jsx("input",{type:"text",...p(`lineItems.${t}.itemDescription`),className:`input mt-1 ${j.lineItems?.[t]?.itemDescription?"border-red-300":""}`,placeholder:"Item description"}),j.lineItems?.[t]?.itemDescription&&i.jsx("p",{className:"mt-1 text-sm text-red-600",children:j.lineItems[t]?.itemDescription?.message})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"SKU/Code"}),i.jsx("input",{type:"text",...p(`lineItems.${t}.itemSku`),className:"input mt-1",placeholder:"SKU or item code"})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Quantity *"}),i.jsx("input",{type:"number",step:"0.001",...p(`lineItems.${t}.quantity`),className:`input mt-1 ${j.lineItems?.[t]?.quantity?"border-red-300":""}`,placeholder:"1"})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Unit Price *"}),i.jsx("input",{type:"number",step:"0.01",...p(`lineItems.${t}.unitPrice`),className:`input mt-1 ${j.lineItems?.[t]?.unitPrice?"border-red-300":""}`,placeholder:"0.00"})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Discount"}),i.jsx("input",{type:"number",step:"0.01",...p(`lineItems.${t}.discountAmount`),className:"input mt-1",placeholder:"0.00"})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"SST Rate (%)"}),(0,i.jsxs)("select",{...p(`lineItems.${t}.sstRate`),className:"input mt-1",children:[i.jsx("option",{value:"0.00",children:"0% (No SST)"}),i.jsx("option",{value:"6.00",children:"6% (Standard SST)"})]})]}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tax Exemption"}),i.jsx("input",{type:"text",...p(`lineItems.${t}.taxExemptionCode`),className:"input mt-1",placeholder:"Exemption code"})]})]}),i.jsx("div",{className:"mt-4 bg-gray-50 p-3 rounded-md",children:(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,i.jsxs)("div",{children:[i.jsx("span",{className:"text-gray-600",children:"Line Total: "}),i.jsx("span",{className:"font-medium",children:I.lineItems?.[t]?.lineTotal||"0.00"})]}),(0,i.jsxs)("div",{children:[i.jsx("span",{className:"text-gray-600",children:"SST Amount: "}),i.jsx("span",{className:"font-medium",children:I.lineItems?.[t]?.sstAmount||"0.00"})]})]})})]},e.id))})]}),(0,i.jsxs)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[i.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-6",children:"Invoice Totals"}),(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),(0,i.jsxs)("span",{className:"font-medium",children:["RM ",c.subtotal.toFixed(2)]})]}),(0,i.jsxs)("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-gray-600",children:"Total Discount:"}),(0,i.jsxs)("span",{className:"font-medium",children:["RM ",c.totalDiscount.toFixed(2)]})]}),(0,i.jsxs)("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-gray-600",children:"SST (6%):"}),(0,i.jsxs)("span",{className:"font-medium",children:["RM ",c.totalSst.toFixed(2)]})]}),i.jsx("div",{className:"border-t pt-3",children:(0,i.jsxs)("div",{className:"flex justify-between text-lg font-semibold",children:[i.jsx("span",{children:"Grand Total:"}),(0,i.jsxs)("span",{children:["RM ",c.grandTotal.toFixed(2)]})]})})]})]}),(0,i.jsxs)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[i.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Additional Information"}),(0,i.jsxs)("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Notes"}),i.jsx("textarea",{...p("invoice.notes"),rows:3,className:"input mt-1",placeholder:"Additional notes or comments..."})]})]}),(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[i.jsx("div",{children:n&&i.jsx("button",{type:"button",onClick:()=>{n&&y&&n(I)},disabled:!y||r,className:"btn-secondary mr-4",children:"Validate Invoice"})}),(0,i.jsxs)("div",{className:"flex space-x-4",children:[i.jsx("button",{type:"button",onClick:()=>b("invoice.status","draft"),className:"btn-secondary",children:"Save as Draft"}),i.jsx("button",{type:"submit",disabled:!y||r,className:"btn-primary",children:r?"Saving...":"create"===l?"Create Invoice":"Update Invoice"})]})]})]})}function $(){let[e,t]=(0,a.useState)(!1),[s,o]=(0,a.useState)(""),[d,c]=(0,a.useState)(null),[m,u]=(0,a.useState)(null),{user:x}=(0,r.a)(),p=(0,n.useRouter)();(0,n.useSearchParams)();let h=async e=>{if(!x?.hasCompletedOnboarding){o("Please complete organization setup first");return}t(!0),o("");try{let t=await l.hi.invoices.create(e);if(t.invoice)p.push(`/invoices/${t.invoice.id}`);else throw Error("Failed to create invoice")}catch(e){console.error("Invoice creation failed:",e),o(e.message||"Failed to create invoice. Please try again.")}finally{t(!1)}},g=async e=>{t(!0),o("");try{let t=await l.hi.invoices.validate(e);c(t.validation)}catch(e){console.error("Invoice validation failed:",e),o(e.message||"Failed to validate invoice")}finally{t(!1)}};return x?.hasCompletedOnboarding?i.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,i.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[i.jsx("div",{className:"mb-8",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[i.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Create Invoice"}),i.jsx("p",{className:"mt-2 text-gray-600",children:"Create a new e-Invoice with Malaysian compliance validation"})]}),i.jsx("div",{className:"flex items-center space-x-4",children:i.jsx("button",{onClick:()=>p.push("/invoices"),className:"btn-secondary",children:"Cancel"})})]})}),s&&i.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-md p-4",children:(0,i.jsxs)("div",{className:"flex",children:[i.jsx("div",{className:"flex-shrink-0",children:i.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:i.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,i.jsxs)("div",{className:"ml-3",children:[i.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),i.jsx("div",{className:"mt-2 text-sm text-red-700",children:i.jsx("p",{children:s})})]})]})}),d&&i.jsx("div",{className:"mb-6 bg-blue-50 border border-blue-200 rounded-md p-4",children:(0,i.jsxs)("div",{className:"flex",children:[i.jsx("div",{className:"flex-shrink-0",children:i.jsx("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:i.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),(0,i.jsxs)("div",{className:"ml-3",children:[(0,i.jsxs)("h3",{className:"text-sm font-medium text-blue-800",children:["Validation Results (Score: ",d.score,"/100)"]}),i.jsx("div",{className:"mt-2 text-sm text-blue-700",children:d.isValid?i.jsx("p",{children:"✅ Invoice passed Malaysian e-Invoice validation!"}):(0,i.jsxs)("div",{children:[i.jsx("p",{children:"❌ Invoice has validation issues:"}),i.jsx("ul",{className:"mt-2 list-disc list-inside",children:d.results?.map((e,t)=>i.jsxs("li",{className:"error"===e.severity?"text-red-700":"text-yellow-700",children:[e.message," - ",e.fixSuggestion]},t))})]})})]})]})}),i.jsx(k,{onSubmit:h,onValidate:g,isLoading:e,templateData:m,mode:"create"})]})}):i.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:i.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:i.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:(0,i.jsxs)("div",{className:"flex",children:[i.jsx("div",{className:"flex-shrink-0",children:i.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:i.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,i.jsxs)("div",{className:"ml-3",children:[i.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Organization Setup Required"}),i.jsx("div",{className:"mt-2 text-sm text-yellow-700",children:i.jsx("p",{children:"You need to complete your organization setup before creating invoices."})}),i.jsx("div",{className:"mt-4",children:i.jsx("div",{className:"-mx-2 -my-1.5 flex",children:i.jsx("button",{onClick:()=>p.push("/org/setup"),className:"bg-yellow-50 px-2 py-1.5 rounded-md text-sm font-medium text-yellow-800 hover:bg-yellow-100",children:"Complete Setup"})})})]})]})})})})}},9816:(e,t,s)=>{"use strict";s.d(t,{KN:()=>i.KN});var i=s(9342)},4696:(e,t,s)=>{"use strict";s.d(t,{U2:()=>i.U2,t8:()=>i.t8});var i=s(9342)},4403:(e,t,s)=>{"use strict";s.d(t,{M:()=>i.M,_:()=>i._});var i=s(7548)},3317:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});let i=(0,s(3189).createProxy)(String.raw`/Users/lazylmf/StudioProjects/Easy-e-Invoice/apps/web/src/app/invoices/create/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),i=t.X(0,[522,790,216,592],()=>s(9154));module.exports=i})();
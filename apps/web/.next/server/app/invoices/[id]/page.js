(()=>{var e={};e.id=690,e.ids=[690],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},7790:e=>{"use strict";e.exports=require("assert")},4770:e=>{"use strict";e.exports=require("crypto")},7702:e=>{"use strict";e.exports=require("events")},2048:e=>{"use strict";e.exports=require("fs")},2615:e=>{"use strict";e.exports=require("http")},5240:e=>{"use strict";e.exports=require("https")},9801:e=>{"use strict";e.exports=require("os")},5315:e=>{"use strict";e.exports=require("path")},6162:e=>{"use strict";e.exports=require("stream")},4175:e=>{"use strict";e.exports=require("tty")},7360:e=>{"use strict";e.exports=require("url")},1764:e=>{"use strict";e.exports=require("util")},1568:e=>{"use strict";e.exports=require("zlib")},9509:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>o,pages:()=>x,routeModule:()=>u,tree:()=>n}),t(1269),t(8928),t(7824);var a=t(3282),i=t(5736),r=t(3906),l=t.n(r),c=t(6880),d={};for(let e in c)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>c[e]);t.d(s,d);let n=["",{children:["invoices",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,1269)),"/Users/lazylmf/StudioProjects/Easy-e-Invoice/apps/web/src/app/invoices/[id]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,8928)),"/Users/lazylmf/StudioProjects/Easy-e-Invoice/apps/web/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,7824,23)),"next/dist/client/components/not-found-error"]}],x=["/Users/lazylmf/StudioProjects/Easy-e-Invoice/apps/web/src/app/invoices/[id]/page.tsx"],o="/invoices/[id]/page",m={require:t,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/invoices/[id]/page",pathname:"/invoices/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:n}})},9567:(e,s,t)=>{Promise.resolve().then(t.bind(t,3943))},3943:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>b});var a=t(3227),i=t(3677),r=t(1043),l=t(3172),c=t(7674),d=t(5691),n=t(5369),x=t(6767),o=t(9616),m=t(5128),u=t(3039),h=t(6670),p=t(1409);let g={draft:"bg-gray-100 text-gray-800",validated:"bg-blue-100 text-blue-800",submitted:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",cancelled:"bg-gray-100 text-gray-800"},y={"01":"Invoice","02":"Credit Note","03":"Debit Note","04":"Refund Note"},j={error:"text-red-600 bg-red-50 border-red-200",warning:"text-yellow-600 bg-yellow-50 border-yellow-200",info:"text-blue-600 bg-blue-50 border-blue-200"},N={error:p.Z,warning:m.Z,info:n.Z};function b(){var e,s;let[t,m]=(0,i.useState)(null),[b,v]=(0,i.useState)(!0),[f,w]=(0,i.useState)(""),[k,F]=(0,i.useState)(""),{user:S}=(0,l.a)(),P=(0,r.useRouter)(),D=(0,r.useParams)().id,I=async()=>{try{v(!0);let e=await c.hi.invoices.get(D);m(e.invoice)}catch(e){console.error("Failed to fetch invoice:",e),w(e.message||"Failed to fetch invoice"),404===e.status&&setTimeout(()=>P.push("/invoices"),2e3)}finally{v(!1)}},C=async()=>{try{F("validate"),await c.hi.invoices.validate(D),await I()}catch(e){console.error("Failed to validate invoice:",e),w(e.message||"Failed to validate invoice")}finally{F("")}},q=async()=>{try{F("duplicate");let e=await c.hi.invoices.duplicate(D);P.push(`/invoices/${e.invoice.id}/edit`)}catch(e){console.error("Failed to duplicate invoice:",e),w(e.message||"Failed to duplicate invoice")}finally{F("")}},T=async()=>{try{F("pdf");let e=await c.hi.export.pdf(D),s=new Blob([await e.blob()],{type:"application/pdf"}),a=window.URL.createObjectURL(s),i=document.createElement("a");i.href=a,i.download=`${t?.invoiceNumber||D}.pdf`,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(a),document.body.removeChild(i)}catch(e){console.error("Failed to export PDF:",e),w(e.message||"Failed to export PDF")}finally{F("")}};return b?a.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"animate-pulse",children:[a.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-4"}),a.jsx("div",{className:"bg-white shadow-sm rounded-lg p-6",children:(0,a.jsxs)("div",{className:"space-y-4",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),a.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),a.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]})})]})})}):f&&!t?a.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,a.jsxs)("div",{className:"flex",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx(p.Z,{className:"h-5 w-5 text-red-400"})}),(0,a.jsxs)("div",{className:"ml-3",children:[a.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),a.jsx("div",{className:"mt-2 text-sm text-red-700",children:a.jsx("p",{children:f})}),a.jsx("div",{className:"mt-4",children:a.jsx("button",{onClick:()=>P.push("/invoices"),className:"bg-red-50 px-2 py-1.5 rounded-md text-sm font-medium text-red-800 hover:bg-red-100",children:"Back to Invoices"})})]})]})})})}):t?a.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsx("div",{className:"mb-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("button",{onClick:()=>P.push("/invoices"),className:"mr-4 p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-full",children:a.jsx(d.Z,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:t.invoiceNumber}),a.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${g[t.status]}`,children:t.status}),t.isConsolidated&&a.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:"B2C Consolidated"})]}),(0,a.jsxs)("p",{className:"mt-2 text-gray-600",children:[y[t.eInvoiceType]," • Issued: ",new Date(t.issueDate).toLocaleDateString(),t.dueDate&&` • Due: ${new Date(t.dueDate).toLocaleDateString()}`]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("button",{onClick:C,disabled:"validate"===k,className:"btn-secondary flex items-center",children:[a.jsx(n.Z,{className:"h-5 w-5 mr-2"}),"validate"===k?"Validating...":"Validate"]}),(0,a.jsxs)("button",{onClick:T,disabled:"pdf"===k,className:"btn-secondary flex items-center",children:[a.jsx(x.Z,{className:"h-5 w-5 mr-2"}),"pdf"===k?"Exporting...":"Export PDF"]}),(0,a.jsxs)("button",{onClick:q,disabled:"duplicate"===k,className:"btn-secondary flex items-center",children:[a.jsx(o.Z,{className:"h-5 w-5 mr-2"}),"duplicate"===k?"Duplicating...":"Duplicate"]}),["draft","validated"].includes(t.status)&&(0,a.jsxs)("button",{onClick:()=>P.push(`/invoices/${t.id}/edit`),className:"btn-primary flex items-center",children:[a.jsx(u.Z,{className:"h-5 w-5 mr-2"}),"Edit"]})]})]})}),f&&a.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-md p-4",children:(0,a.jsxs)("div",{className:"flex",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx(p.Z,{className:"h-5 w-5 text-red-400"})}),(0,a.jsxs)("div",{className:"ml-3",children:[a.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),a.jsx("div",{className:"mt-2 text-sm text-red-700",children:a.jsx("p",{children:f})})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-8",children:[(0,a.jsxs)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Invoice Details"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Invoice Number"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900",children:t.invoiceNumber})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Type"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900",children:y[t.eInvoiceType]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Issue Date"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900",children:new Date(t.issueDate).toLocaleDateString()})]}),t.dueDate&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Due Date"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900",children:new Date(t.dueDate).toLocaleDateString()})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Currency"}),(0,a.jsxs)("p",{className:"mt-1 text-sm text-gray-900",children:[t.currency,"MYR"!==t.currency&&` (Rate: ${t.exchangeRate})`]})]}),t.poNumber&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"PO Number"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900",children:t.poNumber})]}),t.internalRef&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Internal Reference"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900",children:t.internalRef})]})]}),t.notes&&(0,a.jsxs)("div",{className:"mt-6",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Notes"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900 whitespace-pre-wrap",children:t.notes})]})]}),(t.buyerName||!t.isConsolidated)&&(0,a.jsxs)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Buyer Information"}),t.buyerName?(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Name"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900",children:t.buyerName})]}),t.buyerTin&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"TIN"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900",children:t.buyerTin})]}),t.buyerEmail&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900",children:t.buyerEmail})]}),t.buyerPhone&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Phone"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900",children:t.buyerPhone})]}),t.buyerAddress&&(0,a.jsxs)("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Address"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900 whitespace-pre-wrap",children:t.buyerAddress})]})]}):a.jsx("p",{className:"text-sm text-gray-500 italic",children:"No buyer information (B2C consolidated invoice)"})]}),(0,a.jsxs)("div",{className:"bg-white shadow-sm rounded-lg overflow-hidden",children:[a.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Line Items"})}),a.jsx("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Item"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qty"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unit Price"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Discount"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SST"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.lineItems.map(e=>(0,a.jsxs)("tr",{children:[a.jsx("td",{className:"px-6 py-4",children:(0,a.jsxs)("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.itemDescription}),e.itemSku&&(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["SKU: ",e.itemSku]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:parseFloat(e.quantity).toFixed(3)}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[t.currency," ",parseFloat(e.unitPrice).toFixed(2)]}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:parseFloat(e.discountAmount)>0?`${t.currency} ${parseFloat(e.discountAmount).toFixed(2)}`:"-"}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[parseFloat(e.sstRate),"%",parseFloat(e.sstAmount)>0&&` (${t.currency} ${parseFloat(e.sstAmount).toFixed(2)})`]}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium text-gray-900",children:[t.currency," ",parseFloat(e.lineTotal).toFixed(2)]})]},e.id))})]})})]}),(0,a.jsxs)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Totals"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),(0,a.jsxs)("span",{className:"font-medium",children:[t.currency," ",parseFloat(t.subtotal).toFixed(2)]})]}),parseFloat(t.totalDiscount)>0&&(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-gray-600",children:"Total Discount:"}),(0,a.jsxs)("span",{className:"font-medium",children:["-",t.currency," ",parseFloat(t.totalDiscount).toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-gray-600",children:"SST (6%):"}),(0,a.jsxs)("span",{className:"font-medium",children:[t.currency," ",parseFloat(t.sstAmount).toFixed(2)]})]}),a.jsx("div",{className:"border-t pt-3",children:(0,a.jsxs)("div",{className:"flex justify-between text-lg font-semibold",children:[a.jsx("span",{children:"Grand Total:"}),(0,a.jsxs)("span",{children:[t.currency," ",parseFloat(t.grandTotal).toFixed(2)]})]})})]})]})]}),(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Compliance Status"}),(0,a.jsxs)("div",{className:"text-center mb-4",children:[(0,a.jsxs)("div",{className:`text-3xl font-bold ${(e=t.validationScore)>=90?"text-green-600":e>=70?"text-yellow-600":"text-red-600"}`,children:[t.validationScore,"/100"]}),a.jsx("div",{className:"text-sm text-gray-600",children:100===(s=t.validationScore)?"Fully Compliant":s>=90?"Minor Issues":s>=70?"Significant Issues":"Major Issues"}),t.lastValidatedAt&&(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Last validated: ",new Date(t.lastValidatedAt).toLocaleString()]})]}),t.validationResults.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Issues Found:"}),t.validationResults.map(e=>{let s=N[e.severity];return a.jsx("div",{className:`p-3 rounded-md border ${j[e.severity]}`,children:(0,a.jsxs)("div",{className:"flex",children:[a.jsx(s,{className:"h-4 w-4 mr-2 mt-0.5 flex-shrink-0"}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-medium",children:e.message}),e.fieldPath&&(0,a.jsxs)("p",{className:"text-xs opacity-75",children:["Field: ",e.fieldPath]}),e.fixSuggestion&&(0,a.jsxs)("p",{className:"text-xs mt-1 opacity-75",children:["Suggestion: ",e.fixSuggestion]})]})]})},e.id)})]})]}),(0,a.jsxs)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Supplier"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Company Name"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900",children:t.organization.name})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"TIN"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900",children:t.organization.tin})]}),t.organization.sstNumber&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"SST Number"}),a.jsx("p",{className:"mt-1 text-sm text-gray-900",children:t.organization.sstNumber})]})]})]}),(0,a.jsxs)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Quick Actions"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("button",{onClick:()=>window.print(),className:"w-full btn-secondary flex items-center justify-center",children:[a.jsx(h.Z,{className:"h-4 w-4 mr-2"}),"Print Preview"]}),a.jsx("button",{onClick:()=>navigator.share?.({title:`Invoice ${t.invoiceNumber}`,text:`Invoice ${t.invoiceNumber} - ${t.currency} ${parseFloat(t.grandTotal).toFixed(2)}`,url:window.location.href}),className:"w-full btn-secondary",children:"Share Invoice"})]})]})]})]})]})}):null}},1269:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>a});let a=(0,t(3189).createProxy)(String.raw`/Users/lazylmf/StudioProjects/Easy-e-Invoice/apps/web/src/app/invoices/[id]/page.tsx#default`)}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[522,216,592],()=>t(9509));module.exports=a})();